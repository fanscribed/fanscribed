{% extends "transcripts/task_base.html" %}
{% load bootstrap3 %}


{% block title %}
  {% if not task.is_review %}Speaker{% else %}Review Speaker{% endif %}
{% endblock %}


{% block extra_js %}
  {{ block.super }}
  <script type="text/javascript">

    $(function () {

      // Try to focus the first selected radio button.
      var radioToFocus = $('input[type="radio"]:checked').first();
      if (!radioToFocus) {
        // There weren't any selected radio buttons, so focus the first one.
        radioToFocus = $('input[type="radio"]').first();
      }
      radioToFocus.focus();

      // Assign keyboard shortcuts to first 9 speakers.
      $('input[name="speaker"]').each(function () {
        var $input = $(this);
        var id = $input.attr('id');
        var sequence = parseInt(id.substr(11));
        if (1 <= sequence && sequence <= 9) {
          $input.after('<kbd>^' + sequence + '</kbd>');
          var hotkey = 'ctrl+' + sequence;
          function selectSpeaker() {
            $input.attr('checked', 'checked');
            $input.focus();
          }
          $('body').bind('keydown', hotkey, selectSpeaker);
          $('input').bind('keydown', hotkey, selectSpeaker);
          $('textarea').bind('keydown', hotkey, selectSpeaker);
        }
      });

    });

  </script>
{% endblock %}


{% block task_info %}

  <h2>{% if not task.is_review %}Speaker{% else %}Review Speaker{% endif %}</h2>

  {% if user.is_staff and 'details' in request.GET %}
    <dl class="dl-horizontal">
      {% include "transcripts/_task_detail_common.html" %}
    </dl>
  {% endif %}

  <div class="well">{% include "transcripts/_guidelines_speaker.html" %}</div>

{% endblock %}


{% block task_workarea %}

  {% if task.state == 'presented' %}

    <div class="well">
      <p style="font-size:20px"><strong>{{ task.sentence.latest_text }}</strong></p>
    </div>

    <form action="" method="post" class="form">
      {% csrf_token %}
      {% bootstrap_form form %}
      {% include "transcripts/_task_buttons.html" %}
    </form>

  {% else %}

    <h3>Speaker</h3>

    {% if task.speaker %}
      <dt>Speaker</dt>
      <dd>{{ task.speaker.name }}</dd>
    {% endif %}

    {% if task.new_name %}
      <dt>New Name</dt>
      <dd>{{ task.new_name }}</dd>
    {% endif %}

  {% endif %}

{% endblock %}
