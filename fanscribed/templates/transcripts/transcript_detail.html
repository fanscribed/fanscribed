{% extends "base.html" %}


{% block title %}
  {% with episode=transcript.episode %}
    {% if episode %}
      Transcript of
      "{{ episode.title }}"
      (from {{ episode.podcast.title }})
    {% else %}
      {{ transcript.title }}
    {% endif %}
  {% endwith %}
{% endblock %}


{% block nav_class_transcribe %}
  active
{% endblock %}


{% block content %}

  {% url 'transcripts:task_assign' pk=transcript.pk as task_assign_url %}
  {% url 'transcripts:detail' pk=transcript.pk as detail_url %}

  {% include "transcripts/_transcript_title_heading.html" %}

  <div class="row">
    <div class="col-md-8">

      {# -- body -- #}

      {% if transcript.episode %}

        <h2>About This Episode</h2>
        {% include "podcasts/_episode_description.html" with episode=transcript.episode %}

        <hr/>

      {% endif %}

      <h2>Transcript</h2>

      {% if transcript.state == 'finished' %}
        {% include "transcripts/_transcript_sentences_table.html" with sentences=transcript.completed_sentences %}
      {% else %}
        <p class="text-muted">
          Text will appear here when the transcript is finished.
        </p>
        <form action="{{ task_assign_url }}" method="post">
          {% csrf_token %}
          <p>
            {% if user.is_authenticated %}
              <button class="btn btn-default btn-sm" type="submit" name="type" value="any_sequential">
                Help Transcribe
              </button>
              this episode to get it done faster!
            {% else %}
              <a class="btn btn-primary btn-sm"
                 href="{% url 'account_login' %}?next={{ detail_url }}">
                Sign In
              </a>
              or
              <a class="btn btn-default btn-sm"
                 href="{% url 'account_signup' %}?next={{ detail_url }}">
                Sign Up
              </a>
              to help transcribe this episode!
            {% endif %}
          </p>
        </form>
      {% endif %}

    </div>
    <div class="col-md-4">

      {# -- sidebar -- #}

      {% if transcript.state == 'unfinished' %}

        <div class="well">

          <h3 style="margin-top:0">Help Finish This Transcript</h3>

          <p>This transcript is not finished.
          You can help us complete it!</p>

          <p>The process is simple,
          there's no obligation,
          and you can stop at any time.</p>

          {% if user.is_authenticated %}
            {% if transcript.length_state == 'unset' %}
              <p>
                <button class="btn btn-disabled" disabled="disabled">
                  Please Wait...
                </button>
                <p class="text-muted">
                  <small>(We are still processing the audio for this transcript. Please reload the page periodically to update this status.)</small>
                </p>
              </p>
            {% else %}
              <form action="{{ task_assign_url }}" method="post">
                {% csrf_token %}
                {% if perms.transcripts.add_transcribetask %}
                  <button class="btn btn-primary" type="submit" name="type" value="any_sequential">
                    Help Transcribe
                  </button>
                {% endif %}
              </form>
            {% endif %}
          {% else %}
            <p>
              <a class="btn btn-primary"
                 href="{% url 'account_login' %}?next={{ detail_url }}">
                Sign In
              </a>
              or
              <a class="btn btn-default"
                 href="{% url 'account_signup' %}?next={{ detail_url }}">
                Sign Up
              </a>
            </p>
          {% endif %}

        </div>

      {% endif %}

      {% with episode=transcript.episode %}
        {% if episode %}
          <h3>Licensing</h3>
          {% include "podcasts/_podcast_license_approvals.html" with podcast=episode.podcast %}
        {% endif %}
      {% endwith %}

    </div>
  </div>

  {# --- #}

  {% if request.user.is_staff and 'stats' in request.GET %}
    <hr/>
    {% include "transcripts/_transcript_detail_staff.html" %}
  {% endif %}

{% endblock %}
